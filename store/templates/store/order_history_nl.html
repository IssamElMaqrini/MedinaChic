{% extends 'base_nl.html' %}
{% load static %}

{% block content %}
<style>
    .product-thumbnail {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 5px;
    }
</style>

<div style="color: #872D37;">
    <h2 class="mb-4">Mijn Bestelgeschiedenis</h2>
    
    {% if orders %}
        {% for order in orders %}
        <div class="card mb-3">
            <div class="card-header" style="background-color: #872D37; color: white;">
                <div class="d-flex justify-content-between align-items-center">
                    <strong>Bestelling van {{ order.order_date|date:"d/m/Y om H:i" }}</strong>
                    <div>
                        <span class="me-3">Totaal: {{ order.total_amount|floatformat:2 }} €</span>
                        <a href="{% url 'generate-invoice' order.id %}" target="_blank" class="btn btn-sm btn-light">
                            <i class="bi bi-file-earmark-pdf"></i> Factuur downloaden
                        </a>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <h5 class="card-title">Bestelde artikelen:</h5>
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Afbeelding</th>
                            <th>Product</th>
                            <th>Eenheidsprijs</th>
                            <th>Aantal</th>
                            <th>Subtotaal</th>
                            <th>Acties</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in order.items.all %}
                        <tr>
                            <td>
                                {% if item.product_thumbnail %}
                                    <img src="{{ item.product_thumbnail }}" alt="{{ item.product_name }}" class="product-thumbnail">
                                {% else %}
                                    <img src="{% static 'img/logo-bleu.jpg' %}" alt="{{ item.product_name }}" class="product-thumbnail">
                                {% endif %}
                            </td>
                            <td>{{ item.product_name }}</td>
                            <td>{{ item.product_price|floatformat:2 }} €</td>
                            <td>{{ item.quantity }}</td>
                            <td>{{ item.subtotal|floatformat:2 }} €</td>
                            <td>
                                {% if item.product_slug %}
                                    {% if item.has_review %}
                                        <a href="{% url 'add-review-nl' item.product_slug %}" class="btn btn-sm" style="background-color: #C78C3A; color: white;">
                                            ✏️ Beoordeling wijzigen
                                        </a>
                                    {% else %}
                                        <a href="{% url 'add-review-nl' item.product_slug %}" class="btn btn-sm" style="background-color: #872D37; color: white;">
                                            ⭐ Geef beoordeling
                                        </a>
                                    {% endif %}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="text-center py-5">
            <div class="mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" fill="#C78C3A" viewBox="0 0 16 16">
                    <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5 8 5.961 14.154 3.5zM15 4.239l-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z"/>
                </svg>
            </div>
            <div style="background-color: rgba(199, 140, 58, 0.1); border-left: 5px solid #C78C3A; padding: 2rem; border-radius: 10px; max-width: 500px; margin: 0 auto;">
                <h4 style="color: #872D37; margin-bottom: 1rem;">Nog geen bestellingen</h4>
                <p style="color: #872D37; font-size: 1.1rem; margin-bottom: 1.5rem;">
                    Ontdek onze collectie ambachtelijke artikelen en plaats uw eerste bestelling!
                </p>
                <a href="{% url 'index-nl' %}" class="btn btn-lg" style="background-color: #872D37; border-color: #872D37; color: white; padding: 0.75rem 2rem; font-weight: bold; transition: all 0.3s;">
                    ✨ Ontdek onze producten
                </a>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}
